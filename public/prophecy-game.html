<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Prophecy Game</title>
    <style>
        /* --- Basic Setup & Theming --- */
        :root {
            --bg-color: #1a1a2e;
            --primary-color: #16213e;
            --secondary-color: #0f3460;
            --accent-color: #e94560;
            --text-color: #dcdcdc;
            --font-family: 'Segoe UI', 'Roboto', sans-serif;
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-color);
            font-family: var(--font-family);
            margin: 0;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            text-align: center;
            background-image: radial-gradient(circle, var(--secondary-color) 0%, var(--bg-color) 70%);
        }

        /* --- Main Container & Screen Management --- */
        .container {
            width: 100%;
            max-width: 800px;
            background-color: var(--primary-color);
            padding: 2rem 3rem;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.4);
        }

        .screen {
            display: none; /* Hide all screens by default */
        }

        .screen.active {
            display: block; /* Show only the active screen */
        }

        /* --- UI Components --- */
        h1, h2, h3 {
            color: var(--accent-color);
            margin-top: 0;
            letter-spacing: 1px;
        }

        h1 { font-size: 2.5rem; }
        h2 { font-size: 1.8rem; }
        h3 { font-size: 1.4rem; }

        p {
            line-height: 1.6;
            margin-bottom: 1.5rem;
        }

        button {
            background-color: var(--accent-color);
            color: white;
            border: none;
            padding: 12px 25px;
            font-size: 1rem;
            font-weight: bold;
            border-radius: 8px;
            cursor: pointer;
            transition: transform 0.2s ease, background-color 0.2s ease;
            margin: 5px;
        }

        button:hover {
            transform: scale(1.05);
            background-color: #ff5a75;
        }

        button:disabled {
            background-color: #555;
            cursor: not-allowed;
            transform: none;
        }

        input[type="text"], select {
            width: 100%;
            padding: 12px;
            margin-bottom: 15px;
            background-color: var(--secondary-color);
            border: 2px solid var(--bg-color);
            border-radius: 8px;
            color: var(--text-color);
            font-size: 1rem;
            box-sizing: border-box;
        }
        
        textarea {
            width: 100%;
            min-height: 100px;
            padding: 12px;
            margin-bottom: 15px;
            background-color: var(--secondary-color);
            border: 2px solid var(--bg-color);
            border-radius: 8px;
            color: var(--text-color);
            font-size: 1rem;
            box-sizing: border-box;
            resize: vertical;
        }

        label {
            display: block;
            margin-bottom: 8px;
            text-align: left;
            font-weight: bold;
        }

        /* --- Specific Layouts --- */
        .player-inputs {
            margin-bottom: 2rem;
            max-height: 200px;
            overflow-y: auto;
            padding-right: 10px;
        }

        .player-input-group {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }

        .player-input-group input {
            flex-grow: 1;
            margin: 0 10px 0 0;
        }
        
        #game-screen h2 {
            font-size: 2.2rem;
            margin-bottom: 1rem;
        }

        #game-screen p {
            font-size: 1.2rem;
            background-color: var(--secondary-color);
            padding: 1rem;
            border-radius: 8px;
        }

        /* --- Reveal Screen --- */
        .prophecy-scroll {
            background-color: #fdf5e6;
            color: #5d4037;
            border: 5px solid #d2b48c;
            border-radius: 10px;
            padding: 2rem;
            margin: 2rem 0;
            text-align: left;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            animation: fadeIn 1s ease-in-out;
            opacity: 0;
            animation-fill-mode: forwards;
        }

        .prophecy-scroll h3 {
            color: #8b4513;
            text-align: center;
            font-family: 'Garamond', serif;
            font-size: 2rem;
            border-bottom: 2px dashed #d2b48c;
            padding-bottom: 1rem;
            margin-bottom: 1rem;
        }
        
        .prophecy-scroll p {
            font-family: 'Garamond', serif;
            font-size: 1.3rem;
            line-height: 1.8;
            color: #3e2723;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* --- Lobby and Game Messages --- */
        .lobby-players-list {
            list-style: none;
            padding: 0;
            margin-bottom: 1rem;
        }

        .lobby-players-list li {
            background-color: var(--secondary-color);
            padding: 10px;
            border-radius: 5px;
            margin-bottom: 5px;
        }

        .game-message {
            background-color: var(--accent-color);
            color: white;
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 1rem;
            display: none;
        }

    </style>
</head>
<body>

    <div class="container">
        <div id="landing-screen" class="screen active">
            <h1>üîÆ The Prophecy Game</h1>
            <p>Gather your friends, answer strange questions, and reveal your hilariously twisted destiny. No two prophecies are ever the same!</p>
            <input type="text" id="player-name-input" placeholder="Enter Your Name">
            <button onclick="createLobby()">Create Lobby</button>
            <input type="text" id="lobby-id-input" placeholder="Enter Lobby ID">
            <button onclick="joinLobby()">Join Lobby</button>
        </div>

        <div id="lobby-screen" class="screen">
            <h2>Lobby</h2>
            <p>Lobby ID: <strong id="lobby-id-display"></strong></p>
            <h3>Players</h3>
            <ul id="lobby-players" class="lobby-players-list"></ul>
            <div id="setup-options">
                <label for="theme-select">Select a Theme</label>
                <select id="theme-select">
                    <option value="random">üåü Random Mix</option>
                    <option value="classic">üìú Classic Prophecies</option>
                    <option value="cringe"> cringe Cringe Week</option>
                    <option value="fantasy">üè∞ Medieval Fantasy</option>
                </select>

                <label for="gamemode-select">Select a Game Mode</label>
                <select id="gamemode-select">
                    <option value="classic">Classic (Each player builds their own prophecy)</option>
                    <option value="pass-and-build">Pass & Build (Each player adds one line to every prophecy)</option>
                </select>
                <button id="start-game-button" onclick="startGame()">Let the Stars Align ‚ú®</button>
            </div>
        </div>

        <div id="game-screen" class="screen">
            <h2 id="game-player-name">Player's Turn</h2>
            <p id="game-prompt">Your prompt will appear here.</p>
            <div class="game-message" id="game-message-box"></div>
            <textarea id="game-answer" placeholder="Write your prophecy line here..."></textarea>
            <button id="submit-button" onclick="submitAnswer()">Submit</button>
        </div>

        <div id="reveal-screen" class="screen">
            <h2>The Prophecies Are Revealed!</h2>
            <div id="prophecies-container"></div>
            <button onclick="restartGame()">Play Again</button>
        </div>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        const socket = io();

        // ===================================
        // ===== GAME STATE & DATA =========
        // ===================================

        const promptData = {
            classic: [
                "Your greatest adventure will begin when you find a...",
                "You will become famous for inventing a...",
                "Beware the person who offers you a...",
                "Your love life will dramatically change after a...",
                "You will achieve world peace by using a...",
                "Your secret superpower is the ability to control...",
                "A talking animal will give you terrible advice about...",
                "You'll find the answer to your life's problems at the bottom of a...",
            ],
            cringe: [
                "You will go viral on TikTok for accidentally...",
                "Your most embarrassing moment next week will involve a...",
                "You will try to impress your crush by showing them your...",
                "The group chat will expose you for secretly liking...",
                "Your search history will be read aloud at a family dinner, revealing your interest in...",
                "You'll get caught lip-syncing in the mirror to a...",
                "Your first text to a wrong number will be...",
                "You will confidently mispronounce the word...",
            ],
            fantasy: [
                "The ancient dragon guards a legendary treasure known as...",
                "You will unite the warring kingdoms with a magical...",
                "The court wizard foresees you will defeat the lich king using only a...",
                "Your quest is to retrieve the long-lost...",
                "An enchanted forest will grant you the power of...",
                "You'll befriend a grumpy dwarf who is surprisingly good at...",
                "The key to the forbidden temple is hidden inside a...",
                "Your noble steed is not a horse, but a surprisingly fast...",
            ]
        };

        let localPlayer = {
            name: '',
            isHost: false
        };

        // ===================================
        // ===== UTILITY FUNCTIONS =========
        // ===================================

        function showScreen(screenId) {
            document.querySelectorAll('.screen').forEach(screen => {
                screen.classList.remove('active');
            });
            document.getElementById(screenId).classList.add('active');
        }

        function showGameMessage(message, duration = 3000) {
            const messageBox = document.getElementById('game-message-box');
            messageBox.innerText = message;
            messageBox.style.display = 'block';
            setTimeout(() => {
                messageBox.style.display = 'none';
            }, duration);
        }

        // ===================================
        // ===== LOBBY FUNCTIONS ===========
        // ===================================

        function createLobby() {
            const playerName = document.getElementById('player-name-input').value.trim();
            if (!playerName) {
                alert('Please enter your name.');
                return;
            }
            localPlayer.name = playerName;
            localPlayer.isHost = true;
            socket.emit('createLobby', { playerName });
        }

        function joinLobby() {
            const playerName = document.getElementById('player-name-input').value.trim();
            const lobbyId = document.getElementById('lobby-id-input').value.trim();
            if (!playerName || !lobbyId) {
                alert('Please enter your name and a lobby ID.');
                return;
            }
            localPlayer.name = playerName;
            socket.emit('joinLobby', { playerName, lobbyId });
        }
        
        function startGame() {
            const theme = document.getElementById('theme-select').value;
            const gameMode = document.getElementById('gamemode-select').value;
            socket.emit('startGame', { theme, gameMode });
        }

        // ===================================
        // ===== GAME LOGIC FUNCTIONS ======
        // ===================================
        
        function submitAnswer() {
            const answer = document.getElementById('game-answer').value.trim();
            if (answer === '') {
                showGameMessage('The stars demand an answer! Please write something.');
                return;
            }
            socket.emit('submitAnswer', { answer });
            document.getElementById('game-answer').value = '';
            document.getElementById('submit-button').disabled = true;
        }

        function restartGame() {
            socket.emit('restartGame');
        }
        
        // ===================================
        // ===== SOCKET.IO LISTENERS =======
        // ===================================

        socket.on('lobbyCreated', ({ lobbyId, players }) => {
            showScreen('lobby-screen');
            document.getElementById('lobby-id-display').innerText = lobbyId;
            updatePlayerList(players);
            document.getElementById('setup-options').style.display = 'block';
        });

        socket.on('joinedLobby', ({ lobbyId, players, isHost }) => {
            showScreen('lobby-screen');
            document.getElementById('lobby-id-display').innerText = lobbyId;
            updatePlayerList(players);
            localPlayer.isHost = isHost;
            if (!isHost) {
                document.getElementById('setup-options').style.display = 'none';
            }
        });

        socket.on('playerJoined', ({ players }) => {
            updatePlayerList(players);
        });
        
        function updatePlayerList(players) {
            const playerList = document.getElementById('lobby-players');
            playerList.innerHTML = '';
            players.forEach(player => {
                const li = document.createElement('li');
                li.textContent = player.name + (player.isHost ? ' (Host)' : '');
                playerList.appendChild(li);
            });
            const startGameButton = document.getElementById('start-game-button');
            if(localPlayer.isHost) {
                startGameButton.disabled = players.length < 3;
            }
        }
        
        socket.on('gameStarted', (gameState) => {
            showScreen('game-screen');
        });

        socket.on('nextTurn', ({ currentPlayerName, prompt, isMyTurn }) => {
            document.getElementById('game-player-name').innerText = `${currentPlayerName}'s Turn`;
            document.getElementById('game-prompt').innerText = prompt;
            document.getElementById('submit-button').disabled = !isMyTurn;
            if (isMyTurn) {
                showGameMessage("It's your turn!", 2000);
            } else {
                 showGameMessage(`Waiting for ${currentPlayerName} to answer...`, 10000);
            }
        });

        socket.on('revealProphecies', (gameState) => {
            const container = document.getElementById('prophecies-container');
            container.innerHTML = ''; 

            for (let i = 0; i < gameState.players.length; i++) {
                const scroll = document.createElement('div');
                scroll.className = 'prophecy-scroll';
                scroll.style.animationDelay = `${i * 0.3}s`;

                const title = `<h3>${gameState.players[i].name}'s Prophecy</h3>`;
                let prophecyText = '';

                if (gameState.gameMode === 'classic') {
                    prophecyText = `<p>${gameState.prompts[i]} <strong>${gameState.answers[i]}</strong></p>`;
                } else if (gameState.gameMode === 'pass-and-build') {
                    let fullProphecy = '';
                    for (let j = 0; j < gameState.players.length; j++) {
                        fullProphecy += `<p>${gameState.prompts[j]} <strong>${gameState.answers[i][j]}</strong></p>`;
                    }
                    prophecyText = fullProphecy;
                }
                
                scroll.innerHTML = title + prophecyText;
                container.appendChild(scroll);
            }

            showScreen('reveal-screen');
        });

        socket.on('lobbyNotFound', () => {
            alert('Lobby not found!');
        });

        socket.on('gameError', (message) => {
            alert(message);
        });

        socket.on('returnToLobby', () => {
            showScreen('lobby-screen');
            if (localPlayer.isHost) {
                 document.getElementById('setup-options').style.display = 'block';
            }
        });

    </script>
</body>
</html>
